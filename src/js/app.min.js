function GetElementsByClassName(e,o){var t=null;if(e.className==o)return e;for(var r=0;e.childNodes.length>r&&(1!=e.childNodes[r].nodeType||(t=GetElementsByClassName(e.childNodes[r],o),null==t));r++);return t}function GetElementById(e,o){document.getElementById(o);var t=null;if(e.getAttribute("id")==o)return e;for(var r=0;e.childNodes.length>r&&(1!=e.childNodes[r].nodeType||(t=GetElementById(e.childNodes[r],o),null==t));r++);return t}function getAllElementsWithAttribute(e,o){for(var t=[],r=document.getElementsByTagName("*"),n=0,s=r.length;s>n;n++){var i=r[n].getAttribute(e);if("string"==typeof i&&(!o||o&&i==o))return r[n]}return t}function dom$(e,o){var t,r,n,s,i=/([\w\-]+)/,a=/\[(\d)+\]/,l=/=([\w\-\/'.]+)/,c=document;if(o||(o=c),e){if(r=e.split(" "),n=i.exec(r[0]),n[1]){if(0===r[0].indexOf("."))t=t=o==c?c.getElementsByClassName(n[1]):GetElementsByClassName(o,n[1]);else if(0===r[0].indexOf("#"))t=t=o==c?c.getElementById(n[1]):GetElementById(o,n[1]);else if(0===r[0].indexOf("@")){var u=l.exec(r[0]);t=getAllElementsWithAttribute(n[1],u?u[1]:u)}else t=t=o==c?c.getElementById(n[1]):GetElementById(o,n[1]),t||(t=o.getElementsByTagName(n[1]));s=a.exec(r[0]),s&&s[1]&&(t=t[s[1]])}return r[1]?(e=e.substring(e.indexOf(r[1]),e.length),dom$(e,t)):t}}function domPurge(e){var o,t,r,n=e.attributes;if(n)for(o=n.length-1;o>=0;o-=1)r=n[o].name,"function"==typeof e[r]&&(e[r]=null);if(n=e.childNodes)for(t=n.length,o=0;t>o;o+=1)domPurge(e.childNodes[o])}function checkObj(e){return"object"==typeof e?e:dom$(e)}function domRemove(e){var o=document.getElementById(e);return domPurge(o),o.parentNode.removeChild(o)}function domAttr(){}function domCSS(){}function domVal(e){return dom$(e).value}function domHide(e){setStyle(dom$(e),"display","none")}function domShow(e){setStyle(dom$(e),"display","block")}function objectIsEmpty(e){for(var o in e)return!1;return!0}function objectLength(e){var o=0;for(var t in e)e.hasOwnProperty(t)&&++o;return o}function objectFindByKey(e,o,t){for(var r=0;e.length>r;r++)if(e[r][o]===t)return e[r];return null}function objectCheck(e){return"object"==typeof e?e:dom$(e)}function objectClone(e){var o=e instanceof Array?[]:{};for(i in e)"clone"!=i&&(o[i]=e[i]&&"object"==typeof e[i]?objectClone(e[i]):e[i]);return o}function objectURL(e,o){var t=[];for(var r in e){var n=o?o+"["+r+"]":r,s=e[r];t.push("object"==typeof s?serialize(s,n):encodeURIComponent(n)+"="+encodeURIComponent(s))}return t.join("&")}function arrayUnique(e,o){var t,r={},n=[],s=e.length;if(o){for(t=0;s>t;t+=1)e[t][o]in r||(r[e[t][o]]=e[t][o],n.push(e[t]));return n}for(t=0;s>t;++t)e[t]in r||(n.push(e[t]),r[e[t]]=1);return n}function inArray(e,o){for(var t=0,r=o.length;r>t;t++)if(o[t]==e)return!0;return!1}function arrayIndexOf(e,o){for(var t=0,r=e.length;r>t;t++)if(e[t]===o)return t;return-1}function replaceElem(e,o){o.parentNode.replaceChild(e,o)}function getName(e){return e.name}function getValue(e){return e.value}function getType(e){return e.type}function getChecked(e){return e.checked}function getLength(e){return e.length}function getInnerHTML(e){return e.innerHTML}function getClassName(e){return e.className}function getParentNode(e){return e.parentNode}function getStyle(e,o){return e=e.style,e[o]?e[o]:null}function getStyleDisplay(e){return getStyle(e,"display")}function setValue(e,o){e.value=o}function setSrc(e,o){e.src=o}function setInnerHTML(e,o){e.innerHTML=o}function replaceInnerHTML(e,o){var t=e,r=e.cloneNode(!1);r.innerHTML=o,replaceElem(r,t),e=r}function setClassName(e,o){e.className=o}function setStyle(e,o,t){e=e.style,e[o]=t}function setStyleDisplay(e,o){setStyle(e,"display",o?"":"none")}function toggleStyleDisplay(e){"none"===getStyleDisplay(e)?setStyleDisplay(e,1):setStyleDisplay(e,0)}function toggleValue(e,o,t){getInnerHTML(e)===o?setInnerHTML(e,t):getInnerHTML(e)===t&&setInnerHTML(e,o)}function addInnerHTML(e,o,t){setInnerHTML(e,t?getInnerHTML(e)+o:o+getInnerHTML(e))}function onEnter(e){return 13===e?!0:void 0}function domRemove(e){null!=e&&e.parentNode.removeChild(e)}function addEvent(e,o,t){if(e.addEventListener)return e.addEventListener(o,t,!1),!0;if(e.attachEvent){var r=e.attachEvent("on"+o,t);return r}return!1}function getFormData(e){obj=dom$(e);for(var o,t,r={},n=/[\[\]]/,s=obj.getElementsByTagName("input"),i=0;s.length>i;i++)t=null,"checkbox"==s[i].type||"radio"==s[i].type?s[i].checked&&(t=s[i].value):t=s[i].value,t&&(o=s[i].name.split(n),1==o.length?r[o[0]]=t:(r[o[0]]===void 0&&(r[o[0]]={}),r[o[0]][o[1]]=t));for(var a=obj.getElementsByTagName("select"),i=0;a.length>i;i++)o=a[i].name.split(n),1==o.length?r[o[0]]=a[i].value:(r[o[0]]===void 0&&(r[o[0]]={}),r[o[0]][o[1]]=a[i].value);for(var l=obj.getElementsByTagName("textarea"),i=0;l.length>i;i++)o=l[i].name.split(n),1==o.length?r[o[0]]=l[i].value:(r[o[0]]===void 0&&(r[o[0]]={}),r[o[0]][o[1]]=l[i].value);return r}function format(e,o){if(!e)return e;o||(o="w");var t={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]",w:"[w]",W:"[W]",s:"[s]",S:"[S]",d:"[d]",D:"[D]"},r="",n=0,s=0;for(e.split(""),o.split("");o.length>s&&e.length>n;){var i=e[n],a=o[s];if(t[a]){var l=RegExp(t[a]);l.exec(i)&&(r+=i,s++),n++}else r+=a,s++}return r}function clipboard(e){window.prompt("Copy to clipboard: Ctrl+C, enter",e)}function unix2date(e){var o={};o.time=1e3*e,o.obj=new Date(o.time),o.timezone=6e4*o.obj.getTimezoneOffset();var t=RegExp(/\((\w*)\)/).exec(""+o.obj);return o.timezone_str=null===t?"":t[1],o.year=o.obj.getFullYear(),o.month=o.obj.getMonth()+1,o.day=o.obj.getDate(),o.hour=o.obj.getHours(),o.min=o.obj.getMinutes(),o.sec=o.obj.getSeconds(),o.day_min=60*o.hour+o.min,o.time_day=o.time-6e4*o.day_min,o.str=""+o.obj,o}function date2unix(e,o,t){if(o){t||(t=0);var r=+new Date(o);e=r+6e4*t}var n=60*new Date(e).getTimezoneOffset();return e/1e3-n}function syncVar(e,o){return void 0===o?o=e:"object"==typeof e&&"object"==typeof o?o=syncObject(e,o):"array"==typeof e&&"array"==typeof o&&(o=syncArray(e,o)),o}function syncObject(e,o){for(var t in e)o[t]=void 0===o[t]?e[t]:"object"==typeof e[t]?syncObject(e[t],o[t]):"array"==typeof e[t]?syncArray(e[t],o[t]):e[t];return o}function syncArray(e,o){for(var t=0,r=e.length;r>t;t++)"object"==typeof e[t]?o.push(syncObject(e[t],o[t])):"array"==typeof e[t]?o.push(syncArray(e[t],o[t])):o.push(e[t]);return o}function nl2br(e){return e.replace(/\n/g,"<br />\n")}function numberPadding(e,o){for(var t=""+e;o>t.length;)t="0"+t;return t}function strToARGB(e){for(var o=0,t=0;e.length>t;t++)o=e.charCodeAt(t)+((o<<5)-o);return(255&o>>24).toString(16)+(255&o>>16).toString(16)+(255&o>>8).toString(16)+(255&o).toString(16)}function keyDB(e,o){this.id=e?e+"_":"_",this.keys=db.get(this.id+"keys",[]),this.obj=o||{}}function SignCtrl(e,o,t,r){console.log("SignCtrl ("+e.$id+") "+r.action),e.errors={},e.action=r.action?r.action:"in",console.log(e.action),e.signup={},e.totp={value:"",timer:60},e.account_signup=function(){console.log("account_signup()"),e.signup.referral=t.referral,o.post(e.settings.server+"/account/signup",e.signup).success(function(o){console.log("account_signup.post.success"),console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.signin.email=e.signup.email,e.action="in",$rootScope.alerts=[{"class":"success",label:"Account created!",message:"Check your email for an activation link."}])}).error(function(){console.log("account_signup.post.error"),$rootScope.http_error()})},e.signin={remember:!0},e.account_signin=function(){console.log("account_signin()"),o.post(e.settings.server+"/account/signin",{email:e.signin.email,password:e.signin.password,remember:e.signin.remember}).success(function(o){if(console.log("account_signin.post.success"),console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],!o.alerts&&!o.errors)if(o.totp)e.action="totp",e.user_ID=o.user_ID;else if(o){$rootScope.session=syncVar(o,$rootScope.session),$rootScope.session.save=e.signin.remember,console.log($rootScope.session),$rootScope.saveSession(),e.signin={};var r=t.redirect?t.redirect:$rootScope.settings.dashboard;t.redirect=null,e.href("#/"+r)}else $rootScope.alerts=[{"class":"error",label:"Internal Error",message:"Please notify us about it."}]}).error(function(){console.log("account_signin.post.success"),$rootScope.http_error()})},e.account_totp=function(r){console.log("account_totp("+r+")"),o.put(e.settings.server+"/account/totp/"+r).success(function(o){if(console.log("account_totp.put.success"),console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],!o||o.alerts||o.errors)e.errors.totp="Verification Failed";else{$rootScope.session=syncVar(o,$rootScope.session),$rootScope.session.save=e.signin.remember,console.log($rootScope.session),$rootScope.saveSession(),e.signin={};var r=t.redirect?t.redirect:$rootScope.settings.dashboard;t.redirect=null,e.href("#/"+r)}}).error(function(){console.log("account_totp.put.success"),$rootScope.http_error()})},e.account_signout=function(){console.log("account_signout()"),db.clear(),objectLength($rootScope.session)&&($rootScope.resetSession(),o.get(e.settings.server+"/account/signout").success(function(o){console.log("account_signout.get.success"),console.log(o),$rootScope.alerts=[{"class":"info",label:"Signed Out"}],e.action="in",console.log(objectLength($rootScope.session))}).error(function(){console.log("account_signout.get.error"),$rootScope.http_error()}))},r.confirm_hash&&(e.action="in"),"out"==e.action?(e.account_signout(),e.action="in"):$rootScope.session.user_ID&&e.href("#/"+$rootScope.settings.dashboard)}function PageCtrl(e,o,t){console.log("PageCtrl ("+e.$id+", "+t.page+")"),e.page_url="view/page/"+encodeURIComponent(t.page)+".html"}function SettingsCtrl(e,o,t){console.log("SettingsCtrl "+t.page),e.page_url="view/settings/"+encodeURIComponent(t.page)+".html",e.notify=$rootScope.settings.notify,e.loadNotifications=function(){o.get(e.settings.server+"/user/notify").success(function(o){console.log(o),""!=o&&(e.notify=o)}).error(function(){})},e.updateNotifications=function(){console.log(e.notify),o.put(e.settings.server+"/user/notify",e.notify).success(function(){$rootScope.alerts=[{"class":"success",label:"Notifications:",message:"Saved"}]}).error(function(){})},e.loadNotifications(),e.require_signin()}function SupportCtrl(e,o,t){console.log("SupportCtrl "+t.page),e.page_url="view/support/"+encodeURIComponent(t.page)+".html"}function OnboardCtrl(e,o,t,r){console.log("OnboardCtrl ("+e.$id+") page:"+r.page),e.errors={},r.page&&"start"!=r.page||e.href("#/onboard/"+$rootScope.settings.onboard.start),e.page_url="view/onboard/"+encodeURIComponent(r.page)+".html",e.BuildProgressTracker=function(r,n){console.log("BuildProgressTracker("+r+", "+n+")");var s=dom$("#progress_tracker").getElementsByTagName("a");e.uri();for(var i=!1,a=0,l=s.length;l>a;a++)s[a].className="",s[a].firstChild.innerHTML=a,-1!==s[a].href.indexOf("#/onboard/"+r)?("skip"===n&&(l>a+1?e.href(s[a+1].href):($rootScope.session.timestamp_create=1,t.get($rootScope.settings.server+"/account/onboard_done").success(function(t){console.log("BuildProgressTracker.get.success"),console.log(t),$rootScope.updateSession(function(){var t=o.redirect?o.redirect:$rootScope.settings.dashboard;o.redirect=null,e.href("#/"+t)})}).error(function(){console.log("BuildProgressTracker.get.error"),$rootScope.http_error()}))),s[a].className="current",i=!0):i&&(s[a].href=null,s[a].className="after")},e.button={},e.button.skip=function(){e.href(e.uri()+"/skip")},e.require_signin(function(){e.BuildProgressTracker(r.page,r.action)})}function ConfirmCtrl(e,o,t){console.log("ConfirmCtrl ("+e.$id+")"),console.log(t),e.errors={},e.hash=t&&t.confirm_hash?t.confirm_hash:"",e.status=!1,e.check=function(t){e.errors={},t||(t=e.hash),o.get(e.settings.server+"/account/confirm_email/"+encodeURIComponent(t)).success(function(o){console.log(o),o.alerts&&($rootScope.alerts=o.alerts),o.errors&&(e.errors=o.errors),o.alerts||o.errors||($rootScope.session.email_confirm=!0,console.log($rootScope.session),$rootScope.saveSession(),$rootScope.alerts=[{"class":"success",label:"Email Confirmation:",message:"Confirmed"}])})},e.resend=function(){e.errors={},o.get(e.settings.server+"/account/resend_confirm_email/").success(function(o){console.log(o),o.alerts&&($rootScope.alerts=o.alerts),o.errors&&(e.errors=o.errors),o.alerts||o.errors||($rootScope.alerts=[{"class":"info",label:"Email Confirmation:",message:"Sent"}])})},e.hash&&e.check()}function ResetCtrl(e,o,t){console.log("ResetCtrl ("+e.$id+")"),e.errors={},e.hash=t.reset_hash,e.state={verify:!0,reset:!0,signin:!1},e.auth={},e.password={hash:e.hash,password:""},e.check=function(){o.get(e.settings.server+"/account/reset_check/"+encodeURIComponent(e.hash)).success(function(o){console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(o?(e.state.verify=!0,e.auth=o):e.state.reset=!0,$("#passwordModal").modal("show"))}).error(function(){$rootScope.http_error()})},e.verify=function(){o.put(e.settings.server+"/account/reset_verify/",{hash:e.hash,id:e.ID}).success(function(o){console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.state.verify=!1,e.state.reset=!0,e.auth={})}).error(function(){$rootScope.http_error()})},e.reset=function(){o.put(e.settings.server+"/account/reset_password/",e.password).success(function(o){console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.state.reset=!1,e.state.signin=!0,e.password.new_password="",$rootScope.alerts=[{"class":"success",label:"Password Saved"}])}).error(function(){$rootScope.http_error()})},e.check()}function SecurityCtrl(e,o){console.log("SecurityCtrl ("+e.$id+")"),e.services=[{id:"google",name:"Google Authenticator",website:"https://support.google.com/accounts/bin/answer.py?hl=en&answer=1066447",ios:"https://itunes.apple.com/us/app/google-authenticator/id388497605",android:"https://m.google.com/authenticator",bb:"https://m.google.com/authenticator"}],e.security={},e.security.totp=$rootScope.settings.security.totp,e.loadSecurity=function(){console.log("loadSecurity()"),o.get(e.settings.server+"/user/security").success(function(o){console.log(o),""!=o&&(e.security=o),console.log(e.security)}).error(function(){})},e.updateSecurity=function(){console.log("updateSecurity()"),console.log(e.security),o.put(e.settings.server+"/user/security",e.security).success(function(){$rootScope.alerts=[{"class":"success",label:"Security:",message:"Saved"}]}).error(function(){})},e.loadTOTPService=function(){console.log("loadTOTPService()"),o.get($rootScope.settings.server+"/totp/"+e.security.totp.service).success(function(o){console.log(o),o&&(e.security.totp.secret=JSON.parse(o))}).error(function(){})},e.checkTOTP=function(t){console.log("checkTOTP("+t+")"),e.test_code_check=!0,o.put($rootScope.settings.server+"/totp/"+e.security.totp.secret+"/"+t).success(function(o){console.log(o),e.test_code_return=o}).error(function(){})},e.testPGP=function(e){console.log("testPGP()"),o.put($rootScope.settings.server+"/user/pgp/",e).success(function(e){console.log(e)}).error(function(){})},e.loadSecurity(),e.require_signin()}function UserCtrl(e,o,t){console.log("UserCtrl ("+e.$id+")"),e.errors={user:{},email:{}},e.user={},e.email={},e.password={},e.loadUser=function(t){console.log("loadUser("+t+")"),t||(t=0),o.get(e.settings.server+"/user/"+t).success(function(o){console.log("loadUser.get.success"),console.log(o),e.errors.user=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.user=o)}).error(function(){console.log("loadUser.get.error"),$rootScope.http_error()})},e.loadUserName=function(t){console.log("loadUserName("+t+")"),t||(t=""),o.get(e.settings.server+"/user/name/"+t).success(function(o){console.log("loadUser.get.success"),console.log(o),e.errors.user=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.user=o)}).error(function(){console.log("loadUser.get.error"),$rootScope.http_error()})},e.updateUser=function(){console.log("updateUser()"),e.user.user_ID&&o.put(e.settings.server+"/user/",e.user).success(function(o){console.log("updateUser.put.success"),console.log(o),e.errors.user=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||($rootScope.updateSession(),console.log($rootScope.session),$rootScope.alerts=[{"class":"success",label:"User Information:",message:"Saved"}])}).error(function(){console.log("updateUser.put.error"),$rootScope.http_error()})},e.deleteUser=function(){confirm("Are you sure you want to delete your account?")&&o.get(e.settings.server+"/user/delete").success(function(){e.href("#/sign/out")}).error(function(){$rootScope.http_error()})},e.check={},e.check.user_name=function(t){console.log("check.user_name("+t+")"),t&&o.get(e.settings.server+"/account/unique/"+encodeURIComponent(t)).success(function(o){console.log(o),e.errors.user=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],!o.alerts&&!o.errors}).error(function(){$rootScope.http_error()})},e.updateEmail=function(){o.put(e.settings.server+"/account/email_change/",e.email).success(function(o){console.log(o),e.errors.email=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.email={},$rootScope.updateSession(),$rootScope.alerts=[{"class":"success",label:"Change Email:",message:"Saved"}])}).error(function(){$rootScope.http_error()})},e.compileMarkdown=function(e){if(!e)return e;var o=new Markdown.getSanitizingConverter;return o.makeHtml(e)},e.require_signin(function(){console.log("UserCtrl require_signin"),t.profile_name?e.loadUserName(t.profile_name):t.profile_ID?(t.profile_ID||(t.profile_ID=0),e.user={user_ID:t.profile_ID},e.loadUser(t.profile_ID)):e.user=$rootScope.session.user?objectClone($rootScope.session.user):{user_ID:$rootScope.session.user_ID},console.log(e.user)})}function PasswordCtrl(e,o){console.log("PasswordCtrl ("+e.$id+")"),e.errors={},e.updatePassword=function(){o.put(e.settings.server+"/account/password_change/",e.password).success(function(o){console.log("updatePassword.put.success"),console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.password={},$rootScope.alerts=[{"class":"success",label:"Change Password:",message:"Saved"}])}).error(function(){console.log("updatePassword.put.error"),$rootScope.http_error()})},e.resetPassword=function(t){console.log("reset_password()"),o.get(e.settings.server+"/account/reset_send/"+encodeURIComponent(t)).success(function(o){console.log("resetPassword.get.success"),console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],$rootScope.alerts=[{"class":"info",message:"We have sent an email to "+t+" with further instructions."}]}).error(function(){console.log("resetPassword.get.error"),$rootScope.http_error()})}}function CompanyCtrl(e,o,t){console.log("CompanyCtrl ("+e.$id+")"),e.errors={},e.toggle={},e.company={},e.user={},e.users={},e.location={country_code:$rootScope.country_code},e.locations={},e.loadCompany=function(t){console.log("loadCompany("+t+")"),t||(t=0),o.get(e.settings.server+"/company/"+t).success(function(o){console.log(o),e.errors.user=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.company=o,e.location=o.location_default_ID?o.location:e.location,e.location.primary=!0)}).error(function(){$rootScope.http_error()})},e.loadCompanyName=function(t){console.log("loadCompanyName("+t+")"),t||(t=""),o.get(e.settings.server+"/company/name/"+t).success(function(o){console.log("loadCompanyName.get.success"),console.log(o),e.errors.user=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.company=o,e.location=o.location_default_ID?o.location:e.location,e.location.primary=!0)}).error(function(){console.log("loadCompanyName.get.error"),$rootScope.http_error()})},e.updateCompany=function(){$rootScope.alerts=[],e.company.company_ID?o.put(e.settings.server+"/company/",e.company).success(function(o){console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||($rootScope.session.company=e.company,$rootScope.saveSession(),$rootScope.alerts=[{"class":"success",label:"Company Profile:",message:"Saved"}])}).error(function(){$rootScope.http_error()}):o.post(e.settings.server+"/company/",e.company).success(function(o){console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.company.company_ID=o,$rootScope.session.company_ID=o,$rootScope.session.company=e.company,$rootScope.saveSession(),$rootScope.alerts=[{"class":"success",label:"Company Profile:",message:"Saved"}])}).error(function(){$rootScope.http_error()})},e.loadLocations=function(){console.log("loadLocations"),o.get(e.settings.server+"/location/").success(function(o){if(console.log(o),e.errors.user=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],!o.alerts&&!o.errors){e.locations=o;var t=[];for(var r in o)t.push(o[r].country_code);t=arrayUnique(t);for(var r in t)$rootScope.loadRegions(t[r])}}).error(function(){$rootScope.http_error()})},e.editLocation=function(o){console.log("editLocation(location)"),console.log(o),o||(o={primary:e.locations=={},country_code:$rootScope.country_code.toUpperCase()}),e.location=o},e.updateLocation=function(){console.log("updateLocation"),$rootScope.alerts=[],e.location.location_ID?o.put(e.settings.server+"/location/",e.location).success(function(o){console.log("updateLocation.put.success"),console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.locations[e.location.location_ID]=e.location,$rootScope.alerts=[{"class":"success",label:"Location:",message:"Saved"}])}).error(function(){console.log("updateLocation.put.error"),$rootScope.http_error()}):o.post(e.settings.server+"/location/",e.location).success(function(o){console.log("updateLocation.post.success"),console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.location.location_ID=o,e.locations[e.location.location_ID]=e.location,$rootScope.alerts=[{"class":"success",label:"Location:",message:"Saved"}])}).error(function(){console.log("updateLocation.post.error"),$rootScope.http_error()})},e.deleteLocation=function(t){console.log("deleteLocation("+t+")"),o.delete(e.settings.server+"/location/"+t).success(function(o){console.log("deleteLocation.delete.success"),console.log(o),e.errors.user=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||delete e.locations[t]}).error(function(){console.log("deleteLocation.delete.error"),$rootScope.http_error()})},e.loadUsers=function(){o.get(e.settings.server+"/company/user/").success(function(o){console.log(o),e.errors.user=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.users=o)}).error(function(){$rootScope.http_error()})},e.editUser=function(o){console.log("editUser(user)"),console.log(o),o||(o={user_level:0}),o.user_level=""+o.user_level,e.user=o},e.updateUser=function(){console.log("updateLocation"),$rootScope.alerts=[],e.user.user_ID?o.put(e.settings.server+"/company/user/",e.user).success(function(o){console.log("updateUser.put.success"),console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.users[e.user.user_ID]=e.user,$rootScope.alerts=[{"class":"success",label:"User:",message:"Saved"}])}).error(function(){console.log("updateUser.put.error"),$rootScope.http_error()}):o.post(e.settings.server+"/company/user/",e.user).success(function(o){console.log("updateUser.post.success"),console.log(o),e.errors=o.errors?o.errors:{},$rootScope.alerts=o.alerts?o.alerts:[],o.alerts||o.errors||(e.user.user_ID=o,e.users[e.user.user_ID]=e.user,$rootScope.alerts=[{"class":"success",label:"User:",message:"Saved"}])}).error(function(){console.log("updateUser.post.error"),$rootScope.http_error()})},e.compileMarkdown=function(e){if(!e)return e;var o=new Markdown.getSanitizingConverter;return o.makeHtml(e)},e.require_signin(function(){console.log("CompanyCtrl require_signin"),console.log($rootScope.session.company),t.profile_name?e.loadCompanyName(t.profile_name):t.profile_ID?(t.profile_ID||(t.profile_ID=0),e.company.company_ID=t.profile_ID,e.loadCompany(t.profile_ID)):e.company=$rootScope.session.company?$rootScope.session.company:{company_ID:$rootScope.session.company_ID,country_code:$rootScope.country_code.toUpperCase()},t.page&&(e.loadUsers(),e.loadLocations())})}function ContactCtrl(e,o){console.log("ContactCtrl ("+e.$id+")"),e.errors={},e.contact={},e.sendMessage=function(){e.errors={},o.post(e.settings.server+"/contact/",e.contact).success(function(o){console.log(o),o.alerts&&($rootScope.alerts=o.alerts),o.errors&&(e.errors=o.errors),o.alerts||o.errors||(e.contact={},$rootScope.alerts=[{"class":"success",label:"Message Sent"}])})},e.joinNewsletter=function(){e.errors={},e.contact.message="Please add me to your mailing list",o.post(e.settings.server+"/contact/",e.contact).success(function(o){console.log(o),o.alerts&&($rootScope.alerts=o.alerts),o.errors&&(e.errors=o.errors),o.alerts||o.errors||($rootScope.alerts=[{"class":"success",label:"Joined Newsletter"}])})}}function MessageCtrl(e,o,t){console.log("MessageCtrl ("+e.$id+")"),e.to_name="",e.compose={},e.list=[],e.thread=[],e.loadMessages=function(){console.log("loadMessages()"),o.get($rootScope.settings.server+"/message/list").success(function(o){console.log("loadMessages.get.success"),console.log(o),e.list=o}).error(function(){console.log("loadMessages.get.error")})},e.loadThread=function(t,r){console.log("loadThread("+t+")"),t||(t=0),$rootScope.message.compose={user_ID:t},$rootScope.message.to_name=r,o.get($rootScope.settings.server+"/message/"+t).success(function(o){console.log("loadThread.get.success"),console.log(o),$rootScope.message.to_name=o.user.user_name_first+" "+o.user.user_name_last,e.thread=o.thread,setTimeout(function(){e.scrollBottom()},100),$rootScope.message.updateUnreadCount()}).error(function(){console.log("loadThread.get.error")})},e.send=function(){e.thread.push({user_from_ID:$rootScope.session.user_ID,message:$rootScope.message.compose.message,timestamp:+new Date/1e3}),$rootScope.message.send(),setTimeout(function(){e.scrollBottom()},100)},e.scrollBottom=function(){var e=document.getElementById("thread");e.scrollTop=e.scrollHeight},e.loadMessages(),t.user_ID&&e.loadThread(t.user_ID)}function AppCtrl(e,o,t,r,n,s,i){console.log("AppCtrl ("+o.$id+")"),$rootScope=e,$rootScope.filepicker=r,$rootScope.accessibility=n,$rootScope.message=s,$rootScope.follow=i,o.$on("$viewContentLoaded",function(){}),o.$on("$includeContentLoaded",function(){})}function DashboardCtrl(e,o){console.log("DashboardCtrl ("+e.$id+")"),e.search={query:"",type:$rootScope.settings.account.company?"company":"user"},e.loadSearch=function(){o.get(e.settings.server+"/"+e.search.type+"/search/"+e.search.query).success(function(o){console.log(o),e.results=o}).error(function(){})},e.require_signin(function(){})}(function(e,o,t){"use strict";o.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(e,r){function n(){var e,n,s,l;for(e in a)u(i[e])&&r.cookies(e,t);for(e in i)n=i[e],o.isString(n)?n!==a[e]&&(r.cookies(e,n),l=!0):o.isDefined(a[e])?i[e]=a[e]:delete i[e];if(l){l=!1,s=r.cookies();for(e in i)i[e]!==s[e]&&(u(s[e])?delete i[e]:i[e]=s[e],l=!0)}}var s,i={},a={},l=!1,c=o.copy,u=o.isUndefined;return r.addPollFn(function(){var o=r.cookies();s!=o&&(s=o,c(o,a),c(o,i),l&&e.$apply())})(),l=!0,e.$watch(n),i}]).factory("$cookieStore",["$cookies",function(e){return{get:function(t){return o.fromJson(e[t])},put:function(t,r){e[t]=o.toJson(r)},remove:function(o){delete e[o]}}}])})(window,window.angular),function(){for(var e,o=function(){},t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=t.length,n=window.console=window.console||{};r--;)e=t[r],n[e]||(n[e]=o)}();var Markdown={};(function(){function e(e){return e}function o(){return!1}function t(){}function r(){}t.prototype={chain:function(o,t){var r=this[o];if(!r)throw Error("unknown hook "+o);this[o]=r===e?t:function(e){return t(r(e))}},set:function(e,o){if(!this[e])throw Error("unknown hook "+e);this[e]=o},addNoop:function(o){this[o]=e},addFalse:function(e){this[e]=o}},Markdown.HookCollection=t,r.prototype={set:function(e,o){this["s_"+e]=o},get:function(e){return this["s_"+e]}},Markdown.Converter=function(){function e(e){return e=e.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(e,o,t,r,n,s){return o=o.toLowerCase(),O.set(o,S(t)),n?r:(s&&x.set(o,s.replace(/"/g,"&quot;")),"")})}function o(e){return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,n),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,n),e=e.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,n),e=e.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,n),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,n)}function n(e,o){var t=o;return t=t.replace(/^\n+/,""),t=t.replace(/\n+$/g,""),t="\n\n~K"+(M.push(t)-1)+"K\n\n"}function s(e,t){e=d(e);var r="<hr />\n";return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,r),e=f(e),e=h(e),e=w(e),e=o(e),e=_(e,t)}function i(e){return e=y(e),e=a(e),e=k(e),e=u(e),e=l(e),e=C(e),e=e.replace(/~P/g,"://"),e=S(e),e=b(e),e=e.replace(/  +\n/g," <br>\n")}function a(e){var o=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return e=e.replace(o,function(e){var o=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return o=T(o,"!"==e.charAt(1)?"\\`*_/":"\\`*_")})}function l(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,c),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,c),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,c)}function c(e,o,t,r,n,s,i,a){void 0==a&&(a="");var l=o,c=t.replace(/:\/\//g,"~P"),u=r.toLowerCase(),g=n,d=a;if(""==g)if(""==u&&(u=c.toLowerCase().replace(/ ?\n/g," ")),g="#"+u,void 0!=O.get(u))g=O.get(u),void 0!=x.get(u)&&(d=x.get(u));else{if(!(l.search(/\(\s*\)$/m)>-1))return l;g=""}g=U(g),g=T(g,"*_");var f='<a href="'+g+'"';return""!=d&&(d=p(d),d=T(d,"*_"),f+=' title="'+d+'"'),f+=">"+c+"</a>"}function u(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,g),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,g)}function p(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function g(e,o,t,r,n,s,i,a){var l=o,c=t,u=r.toLowerCase(),g=n,d=a;if(d||(d=""),""==g){if(""==u&&(u=c.toLowerCase().replace(/ ?\n/g," ")),g="#"+u,void 0==O.get(u))return l;g=O.get(u),void 0!=x.get(u)&&(d=x.get(u))}c=T(p(c),"*_[]()"),g=T(g,"*_");var f='<img src="'+g+'" alt="'+c+'"';return d=p(d),d=T(d,"*_"),f+=' title="'+d+'"',f+=" />"}function d(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,o){return"<h1>"+i(o)+"</h1>\n\n"}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,o){return"<h2>"+i(o)+"</h2>\n\n"}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,o,t){var r=o.length;return"<h"+r+">"+i(t)+"</h"+r+">\n\n"})}function f(e){e+="~0";var o=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return P?e=e.replace(o,function(e,o,t){var r=o,n=t.search(/[*+-]/g)>-1?"ul":"ol",s=m(r,n);return s=s.replace(/\s+$/,""),s="<"+n+">"+s+"</"+n+">\n"}):(o=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(o,function(e,o,t,r){var n=o,s=t,i=r.search(/[*+-]/g)>-1?"ul":"ol",a=m(s,i);
return a=n+"<"+i+">\n"+a+"</"+i+">\n"})),e=e.replace(/~0/,"")}function m(e,o){P++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var t=N[o],r=RegExp("(^[ \\t]*)("+t+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+t+")[ \\t]+))","gm"),n=!1;return e=e.replace(r,function(e,o,t,r){var a=r,l=/\n\n$/.test(a),c=l||a.search(/\n{2,}/)>-1;return c||n?a=s(I(a),!0):(a=f(I(a)),a=a.replace(/\n$/,""),a=i(a)),n=l,"<li>"+a+"</li>\n"}),e=e.replace(/~0/g,""),P--,e}function h(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,o,t){var r=o,n=t;return r=$(I(r)),r=E(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r='<pre class="prettyprint linenums"><code>'+r+"\n</code></pre>","\n\n"+r+"\n\n"+n}),e=e.replace(/~0/,"")}function v(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(M.push(e)-1)+"K\n\n"}function y(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,o,t,r){var n=r;return n=n.replace(/^([ \t]*)/g,""),n=n.replace(/[ \t]*$/g,""),n=$(n),n=n.replace(/:\/\//g,"~P"),o+"<code>"+n+"</code>"})}function $(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=T(e,"*_{}[]\\",!1)}function b(e){return e=e.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),e=e.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4")}function w(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,o){var t=o;return t=t.replace(/^[ \t]*>[ \t]?/gm,"~0"),t=t.replace(/~0/g,""),t=t.replace(/^[ \t]+$/gm,""),t=s(t),t=t.replace(/(^|\n)/g,"$1  "),t=t.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,o){var t=o;return t=t.replace(/^  /gm,"~0"),t=t.replace(/~0/g,"")}),v("<blockquote>\n"+t+"\n</blockquote>")})}function _(e,o){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var t=e.split(/\n{2,}/g),r=[],n=/~K(\d+)K/,s=t.length,a=0;s>a;a++){var l=t[a];n.test(l)?r.push(l):/\S/.test(l)&&(l=i(l),l=l.replace(/^([ \t]*)/g,"<p>"),l+="</p>",r.push(l))}if(!o){s=r.length;for(var a=0;s>a;a++)for(var c=!0;c;)c=!1,r[a]=r[a].replace(/~K(\d+)K/g,function(e,o){return c=!0,M[o]})}return r.join("\n\n")}function S(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;")}function k(e){return e=e.replace(/\\(\\)/g,j),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,j)}function C(e){e=e.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4");var o=function(e,o){return'<a href="'+o+'">'+L.plainLinkText(o)+"</a>"};e=e.replace(/<((https?|ftp):[^'">\s]+)>/gi,o);var t=function(e,o){var t,r,n="mailto:";return o.substring(0,n.length)!=n?(t=n+o,r=o):(t=o,r=o.substring(n.length,o.length)),'<a href="'+t+'">'+L.plainLinkText(r)+"</a>"};return e=e.replace(/<((?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+))>/gi,t)}function D(e){return e=e.replace(/~E(\d+)E/g,function(e,o){var t=parseInt(o);return String.fromCharCode(t)})}function I(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")}function E(e){if(!/\t/.test(e))return e;var o,t=["    ","   ","  "," "],r=0;return e.replace(/[\n\t]/g,function(e,n){return"\n"===e?(r=n+1,e):(o=(n-r)%4,r=n+1,t[o])})}function U(e){if(!e)return"";var o=e.length;return e.replace(R,function(t,r){if("~D"==t)return"%24";if(":"==t){if(r==o-1||/[0-9\/]/.test(e.charAt(r+1)))return":";if("mailto:"===e.substring(0,"mailto:".length))return":";if("magnet:"===e.substring(0,"magnet:".length))return":"}return"%"+t.charCodeAt(0).toString(16)})}function T(e,o,t){var r="(["+o.replace(/([\[\]\\])/g,"\\$1")+"])";t&&(r="\\\\"+r);var n=RegExp(r,"g");return e=e.replace(n,j)}function j(e,o){var t=o.charCodeAt(0);return"~E"+t+"E"}var L=this.hooks=new t;L.addNoop("plainLinkText"),L.addNoop("preConversion"),L.addNoop("postConversion");var O,x,M,P;this.makeHtml=function(t){if(O)throw Error("Recursive call to converter.makeHtml");return O=new r,x=new r,M=[],P=0,t=L.preConversion(t),t=t.replace(/~/g,"~T"),t=t.replace(/\$/g,"~D"),t=t.replace(/\r\n/g,"\n"),t=t.replace(/\r/g,"\n"),t="\n\n"+t+"\n\n",t=E(t),t=t.replace(/^[ \t]+$/gm,""),t=o(t),t=e(t),t=s(t),t=D(t),t=t.replace(/~D/g,"$$"),t=t.replace(/~T/g,"~"),t=L.postConversion(t),M=x=O=null,t};var N={ol:"\\d+[.]",ul:"[*+-]"},R=/(?:["'*()[\]:]|~D)/g}})(),function(){function e(e){return e.replace(/<[^>]*>?/gi,o)}function o(e){return e.match(s)||e.match(i)||e.match(a)||e.match(l)?e:""}function t(e){if(""==e)return"";var o=/<\/?\w+[^>]*(\s|$|>)/g,t=e.toLowerCase().match(o),r=(t||[]).length;if(0==r)return e;for(var n,s,i,a="<p><img><br><li><hr>",l=[],c=[],u=!1,p=0;r>p;p++)if(n=t[p].replace(/<\/?(\w+).*/,"$1"),!(l[p]||a.search("<"+n+">")>-1)){if(s=t[p],i=-1,!/^<\//.test(s))for(var g=p+1;r>g;g++)if(!l[g]&&t[g]=="</"+n+">"){i=g;break}-1==i?u=c[p]=!0:l[i]=!0}if(!u)return e;var p=0;return e=e.replace(o,function(e){var o=c[p]?"":e;return p++,o})}var r,n;"object"==typeof exports&&"function"==typeof require?(r=exports,n=require("./Markdown.Converter").Converter):(r=window.Markdown,n=r.Converter),r.getSanitizingConverter=function(){var o=new n;return o.hooks.chain("postConversion",e),o.hooks.chain("postConversion",t),o};var s=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,i=/^(<a\shref="(https?:(\/\/|\/)|ftp:(\/\/|\/)|mailto:|magnet:)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,a=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i,l=/^(<pre(\sclass="prettyprint linenums")?>|<\/pre>)$/i}();var db={on:!1,ls:localStorage,init:function(){var e,o=+new Date;try{e=this.get(o,o)==o,this.remove(o),this.on=e}catch(t){}},get:function(e,o){"undefined"===o||this.ls.getItem(e)||this.set(e,o);var t=this.ls.getItem(e);return"undefined"===t?t:JSON.parse(t)},set:function(e,o){null!==e&&this.ls.setItem(e,JSON.stringify(o))},remove:function(e){this.ls.removeItem(e)},clear:function(){this.ls.clear()}};db.init(),keyDB.prototype.get=function(e,o){return db.get(this.id+e,o)},keyDB.prototype.set=function(e,o){if("undefined"!=o&&"undefined"!=e){db.set(this.id+e,o);var t=this.keys.indexOf(e);-1===t&&(this.keys.push(e),db.set(this.id+"keys",this.keys))}},keyDB.prototype.remove=function(e){db.remove(this.id+e);var o=this.keys.indexOf(e);-1!==o&&(this.keys.splice(o,1),db.set(this.id+"keys",this.keys))},keyDB.prototype.getAllArray=function(e,o){"function"==typeof o&&(o=o());for(var t=[],r=0,n=this.keys.length;n>r;r++)t.push(this.get(this.keys[r]));return!t.length&&e&&o&&(this.setAllArray(e,o),t=o),t},keyDB.prototype.getAllObject=function(e){"function"==typeof e&&(e=e());for(var o={},t=0,r=this.keys.length;r>t;t++)o[this.keys[t]]=this.get(this.keys[t]);return!o.length&&e&&(this.setAllObject(e),o=e),o},keyDB.prototype.setArray=function(e,o){if(e)for(var t=0,r=o.length;r>t;t++)this.set(o[t][e],o[t])},keyDB.prototype.setObject=function(e){for(var o in e)this.set(o,e[o])},keyDB.prototype.setAllArray=function(e,o){e&&(this.clear(),this.setArray(e,o))},keyDB.prototype.setAllObject=function(e){this.clear(),this.setObject(e)},keyDB.prototype.clear=function(){for(var e=0,o=this.keys.length;o>e;e++)db.remove(this.id+this.keys[e]);db.remove(this.id+"keys")},angular.module("ng.components",[]).directive("tabs",function(){return{restrict:"E",transclude:!0,scope:{},controller:function(e){var o=e.panes=[];e.select=function(e){angular.forEach(o,function(e){e.selected=!1}),e.selected=!0},this.addPane=function(t){0==o.length&&e.select(t),o.push(t)}},template:'<div class="tabbable"><ul class="nav nav-tabs"><li data-ng-repeat="pane in panes" data-ng-class="{active:pane.selected}"><a href="" data-ng-click="select(pane)">{{pane.title}}</a></li></ul><div class="tab-content" data-ng-transclude></div></div>',replace:!0}}).directive("pane",function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(e,o,t,r){r.addPane(e)},template:'<div class="tab-pane" data-ng-class="{active: selected}" data-ng-transclude></div>',replace:!0}}),angular.module("ui.directives.if",[]).directive("uiIf",[function(){return{transclude:"element",priority:1e3,terminal:!0,restrict:"A",compile:function(e,o,t){return function(e,o,r){o[0].doNotMove=!0;var n,s,i=r.uiIf;e.$watch(i,function(r){n&&(n.remove(),n=null),s&&(s.$destroy(),s=null),r&&(s=e.$new(),t(s,function(e){n=e,o.after(e)})),o.parent().trigger("$childrenChanged")})}}}}]),angular.module("io.directive.htmlExtend",[]).directive(["focus","blur","keyup","keydown","keypress"].reduce(function(e,o){var t="ng"+o[0].toUpperCase()+o.substr(1);return e[t]=["$parse",function(e){return function(r,n,s){var i=e(s[t]);n.bind(o,function(e){r.$apply(function(){i(r,{$event:e})})})}}],e},{})),angular.module("io.directive.inputMask",[]).directive("inputMask",[function(){return{require:"ngModel",link:function(e,o,t,r){o.bind("keyup",function(n){var s=n.shiftKey,i=n.keyCode;o.prop("selectionStart"),!s&&i>=97&&122>=i&&(i-=32),i>=48&&90>=i&&e.$apply(function(){value=format(r.$viewValue,t.inputMask),o.val(value),r.$setViewValue(value.replace(/[^a-zA-Z0-9]+/g,""))})}),r.$render=function(){if(r.$viewValue){var e=format(r.$viewValue,t.inputMask);o.val(e),r.$setViewValue(e.replace(/[^a-zA-Z0-9]+/g,""))}}}}}]),angular.module("io.directive.markdown",[]).directive("markdown",function(){var e=new Markdown.getSanitizingConverter;return{restrict:"E",link:function(o,t){t.html(e.makeHtml(t.text()))}}}),angular.module("io.filter.range",[]).filter("range",function(){return function(e,o,t,r){if(isNaN(t)&&(t=o,o=0),isNaN(r)&&(r=1),o=parseInt(o),t=parseInt(t),o>t){var n=o;o=t,t=n}for(var s=o;t>s;s+=r)e.push(""+s);return e}}),angular.module("io.filter.truncate",[]).filter("truncate",function(){return function(e,o,t){return isNaN(o)&&(o=10),void 0===t&&(t="..."),o>=e.length||o>=e.length-t.length?e:(e+"").substring(0,o-t.length)+t}}),angular.module("io.filter.format",[]).filter("format",function(){return function(e,o){return format(e,o||"w")}}).filter("phone",function(){return function(e,o){return format(e,o||"(999) 999-9999 x99999")}}),function(e){e.module("io.factory.follow",[]).factory("$follow",["$rootScope","$http",function(e,o){console.log("FollowFactory ("+e.$id+")");var t={};return t.version="0.2.0",t.init=function(e,o,r){console.log("init("+e+","+o+")"),e||(e=0),o||(o=0),r||(r=!1),t.db||(t.db={}),t.db.groups||(t.db.groups={}),t.db.company||(t.db.company={}),t.db.user||(t.db.user={}),e?(t.db.company[e]||(t.db.company[e]={}),t.db.company[e].company_ID=e,t.db.company[e].following=r,t.db.company[e].groups||(t.db.company[e].groups=[])):o&&(t.db.user[o]||(t.db.user[o]={}),t.db.user[o].user_ID=o,t.db.user[o].following=r,t.db.user[o].groups||(t.db.user[o].groups=[]))},t.addFollow=function(r,n,s){console.log('addFollow("'+r+'", "'+n+'", "'+s+'")'),(r||n)&&(r||(r=0),n||(n=0),s||(s=0),t.init(r,n,!0),s&&(r?t.db.company[r].groups.push(s):n&&t.db.user[n].groups.push(s)),o.put(e.settings.server+"/follow/"+r+"/"+n+"/"+s).success(function(e){console.log("addFollow.put.success"),console.log(e)}).error(function(){console.log("addFollow.put.error"),e.http_error()}))},t.deleteFollow=function(r,n,s){if(console.log(e.settings.server+"deleteFollow("+r+", "+n+", "+s+")"),r||(r=0),n||(n=0),s||(s=0),s){if(n){var i=t.db.user[n].groups.indexOf(s);-1!=i&&delete t.db.user[n].groups.splice(i,1),t.db.groups[""+s].group_count--}else if(r){var i=t.db.company[r].groups.indexOf(s);-1!=i&&delete t.db.company[r].groups.splice(i,1),t.db.groups[""+s].group_count--}}else n?(t.db.user[n].following=!1,t.db.user[n].groups=[]):r&&(t.db.company[r].following=!1,t.db.company[r].groups=[]);o({method:"DELETE",url:e.settings.server+"/follow/"+r+"/"+n+"/"+s}).success(function(){console.log("deleteFollow.put.success")}).error(function(){console.log("deleteFollow.put.error"),e.http_error()})},t.loadFollow=function(r,n){console.log("loadFollow("+r+", "+n+")"),r||(r=0),n||(n=0),o.get(e.settings.server+"/follow/"+r+"/"+n).success(function(e){console.log("loadFollow.get.success"),console.log(e),t.db.company[e.company_ID]=e,t.db.user[e.user_ID]=e,t.f=e}).error(function(){console.log("loadFollow.put.error"),e.http_error()})},t.loadFollowers=function(r,n,s){r||(r=0),n||(n=0),s||(s=""),o.get(e.settings.server+"/follow/ers/"+r+"/"+n+"/"+s).success(function(e){console.log("loadFollowers.get.success"),console.log(e);for(var o in e)o?(e[o].following=e[o].following?!0:!1,e[o].follower=!0,t.db[type][o]=e[o]):delete e[o]}).error(function(){console.log("loadFollowers.get.error"),e.http_error()})},t.loadFollowing=function(r,n,s){r||(r=0),n||(n=0),s||(s=""),o.get(e.settings.server+"/follow/ing/"+r+"/"+n+"/"+s).success(function(e){console.log("loadFollowing.get.success"),console.log(e),console.log(typeof e);for(var o=0,r=e.length;r>o;o++)e[o].following=e[o].following?!0:!1,e[o].company_ID?t.db.company[e[o].company_ID]=e[o]:e[o].user_ID&&(t.db.user[e[o].user_ID]=e[o])}).error(function(){console.log("loadFollowing.get.error"),e.http_error()})},t.loadGroups=function(){console.log("loadGroups()"),o.get(e.settings.server+"/follow/group/").success(function(e){console.log("loadGroups.get.success"),console.log(e);for(var o in e)t.db.groups[o]=e[o]}).error(function(){console.log("loadGroups.get.error"),e.http_error()})},t.addGroup=function(r){console.log("addGroup("+r+")");var n=strToARGB(r).substr(0,6);o.post(e.settings.server+"/follow/group/",{group_name:r,color:n}).success(function(e){console.log("addGroup.post.success"),console.log(e),t.db.groups[""+e]={group_name:r,group_ID:e,group_count:0,color:n},console.log(t.db.groups),t.group_name=""}).error(function(){console.log("addGroup.post.error"),e.http_error()})},t.removeGroup=function(r){console.log("removeGroup("+r+")"),o({method:"DELETE",url:e.settings.server+"/follow/group/"+r}).success(function(e){console.log("removeGroup.delete.success"),console.log(e),delete t.db.groups[r];for(var o in t.db.company)if(t.db.company[o].groups){var n=t.db.company[o].groups.indexOf(r);-1!=n&&delete t.db.company[o].groups.splice(n,1)}for(var o in t.db.user)if(t.db.user[o].groups){var n=t.db.user[o].groups.indexOf(r);-1!=n&&delete t.db.user[o].groups.splice(n,1)}}).error(function(){console.log("removeGroup.delete.error"),e.http_error()})},e.$watch("session.user_ID",function(e){e&&(t.loadGroups(),t.init())}),t}])}(angular),angular.module("io.factory.filepicker",[]).factory("$filepicker",["$rootScope","$http",function(e,o){console.log("FilepickerFactory ("+e.$id+")");var t={};return t.version="0.2.0",t.alerts=[],t.services={"":{name:"Filepicker",icon:"upload-alt"},DOWNLOAD:{name:"Download",icon:"cloud-download"},RESIZECROP:{name:"Resize & Crop Image",icon:"fullscreen"},CAMERA:{name:"Take Picture",icon:"camera-retro"},COMPUTER:{name:"My Computer",icon:"home"},URL:{name:"Link (URL)",icon:"link"},FTP:{name:"FTP",icon:"hdd"},WEBDAV:{name:"WebDAV",icon:"hdd"},DROPBOX:{name:"Dropbox",icon:"dropbox",url:"https://dropbox.com/"}},t.args_upload={type:"UPLOAD",action:"",types:["*/*"],extensions:[],services:["COMPUTER","URL"],service:"COMPUTER",multi:!0,ID:""},t.args_download={type:"DOWNLOAD",action:"",files:{},services:["COMPUTER"],service:"COMPUTER",ID:""},t.args={},t.accept="",t.timestamp=+new Date,t.dropzone_name="files",t.loadFiles=function(){t.args.multi&&o.get(e.settings.server+"/filepicker/list/"+t.args.action+"/"+t.args.ID).success(function(e){t.args.files=e}).error(function(){})},t.upload=function(e,o){o||(o=""),console.log(e),console.log(o),t.alerts=[],t.args=syncVar(e,t.args_upload),t.args.ID=o,t.cameraModernizr(),t.location(t.args.service),t.loadFiles(),t.accept=t.args.extensions.length?t.args.extensions.join(","):t.args.types.join(","),t.setDropzoneName(),$("#filepickerModal").modal("show")},t.view=function(e,o){o||(o=""),console.log(o),t.alerts=[],t.args=syncVar(e,t.args_download),t.args.ID=o,t.loadFiles()},t.download=function(e,o){o||(o=""),console.log(o),t.alerts=[],t.args=syncVar(e,t.args_download),t.args.ID=o,t.loadFiles(),$("#filepickerModal").modal("show")},t.downloadFile=function(r){o.post(e.settings.server+"/filepicker/download/"+t.args.action+"/"+t.args.ID,{file:r}).success(function(o){console.log(o),o.errors&&(t.errors=o.errors),o.alerts&&(t.alerts=o.alerts),o.errors||o.alerts||(e.alerts=[{"class":"success",label:"File deleted"}])}).error(function(){})},t.confirmDelete=function(o,t){console.log("filepicker.confirmDelete()"),e.modal={hide:{header:!1,close:!1,footer:!1},header:"Confirm File Delete",content:"Are you sure you want to delete '"+o+"'?",buttons:[{"class":"btn-primary",value:"Delete",callback:function(){t(o)}},{"class":"",value:"Cancel",callback:function(){}}]},$("#alertModal").modal("show")},t.delete=function(r){o.delete(e.settings.server+"/filepicker/"+t.args.action+"/"+t.args.ID+"/"+encodeURIComponent(r)).success(function(o){o.errors&&(t.errors=o.errors),o.alerts&&(t.alerts=o.alerts),o.errors||o.alerts||(e.alerts=[{"class":"success",label:"File deleted"}],t.view(t.args,t.args.ID))}).error(function(){})},t.close=function(){this.timestamp=+new Date},t.location=function(e){"CAMERA"==e&&t.cameraInit(),t.args.service=e},t.setDropzoneName=function(){t.dropzone_name=t.args.resizecrop?"image":"file"},t.camera={},t.cameraModernizr=function(){console.log("cameraModernizr");var e=function(){return navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),window.URL||(window.URL=window.webkitURL||window.mozURL),!!navigator.getUserMedia};e()||(console.log("!hasUserMedia"),t.cameraRemove())},t.cameraRemove=function(){t.args.services.splice(t.args.services.indexOf("CAMERA"),1),"CAMERA"===t.args.service&&(t.args.service=t.args.services[0])},t.cameraInit=function(){navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),window.URL||(window.URL=window.webkitURL||window.mozURL);var e=document.getElementById("camera");t.camera.video=e.querySelector("video"),t.camera.canvas=e.querySelector("canvas"),t.camera.canvas.width=2*t.args.width,t.camera.canvas.height=2*t.args.height,t.camera.ctx=t.camera.canvas.getContext("2d");var o=function(e){console.log("camera Fail",e),t.cameraRemove()},r=function(e){t.camera.video.src=/Chrome/.test(navigator.userAgent)?window.URL.createObjectURL(e):e,t.camera.stream=e,t.camera.video.width=t.camera.canvas.width,t.camera.video.height=t.camera.canvas.height,t.camera.video.onloadedmetadata=function(){console.log("metadata loaded")}};navigator.getUserMedia({video:!0},r,o)},t.cameraStop=function(){t.camera.video.pause(),t.camera.stream.stop(),t.camera.video.src=null,t.camera.video.mozSrcObject=null,t.camera.video.src=""},t}]),function(e){e.module("io.factory.message",[]).factory("$message",["$rootScope","$http","$routeParams",function(e,o){console.log("MessageFactory ("+e.$id+")");var t={};return t.version="0.1.0",t.unread=0,t.init=function(){t.alerts=[],t.to_name="",t.compose={}},t.open=function(e,o){t.init(),t.compose={user_ID:e},t.to_name=o,$("#messageModal").modal("show")},t.close=function(){$("#messageModal").modal("hide")},t.updateUnreadCount=function(){console.log("updateUnreadCount()"),o.get(e.settings.server+"/message/unread").success(function(e){console.log("updateUnreadCount.get.success"),console.log(e),t.unread=e}).error(function(){console.log("updateUnreadCount.get.error")})},t.send=function(){console.log("send()"),o.post(e.settings.server+"/message",t.compose).success(function(e){console.log("send.get.success"),console.log(e),t.compose.message="",t.alerts=[{"class":"success",label:"Message sent:",message:"Click to go to conversation."}]}).error(function(){console.log("send.get.error")})},e.$watch("session.user_ID",function(e){e&&t.updateUnreadCount()}),t}])}(angular),function(e){e.module("io.factory.accessibility",[]).factory("$accessibility",["$rootScope","$http",function(e){console.log("AccessibilityFactory ("+e.$id+")");var o={};return o.version="0.1.0",o.css_file="css/accessibility.min.css",o.settings=db.get("accessibility",{accessibility:!1,zoom:1}),o.init=function(){console.log("$accessibility.init()"),o.settings.accessibility&&o.load()},o.save=function(){db.set("accessibility",o.settings),console.log(o.settings)},o.toggle=function(){console.log("$accessibility.toggle()"),o.settings.accessibility=o.settings.accessibility?!1:!0,o.load()},o.load=function(){console.log("$accessibility.load()"),o.settings.accessibility?e.loadStyle(o.css_file):e.unloadStyle(o.css_file),o.save()},o.zoom=function(e){e||(e=1),o.settings.zoom=e,document.body.style["font-size"]=100*o.settings.zoom+"%",o.save()},e.$watch(e,function(){o.init()}),o}])}(angular),SignCtrl.$inject=["$scope","$http","$cookies","$routeParams"],PageCtrl.$inject=["$scope","$http","$routeParams"],SettingsCtrl.$inject=["$scope","$http","$routeParams"],SupportCtrl.$inject=["$scope","$http","$routeParams"],OnboardCtrl.$inject=["$scope","$cookies","$http","$routeParams"],ConfirmCtrl.$inject=["$scope","$http","$routeParams"],ResetCtrl.$inject=["$scope","$http","$routeParams"],SecurityCtrl.$inject=["$scope","$http"],UserCtrl.$inject=["$scope","$http","$routeParams"],PasswordCtrl.$inject=["$scope","$http"],CompanyCtrl.$inject=["$scope","$http","$routeParams"],angular.module("io.controller.filepicker",[]).controller("FilepickerCtrl",["$scope","$http","$filepicker",function(e,o,t){function r(o){o.stopPropagation(),o.preventDefault(),e.$apply(function(){e.filepicker.setDropzoneName(!0),e.dropClass=""})}function n(o){e.$apply(function(){e.progress=o.lengthComputable?Math.round(100*o.loaded/o.total):"unable to compute"})}function s(o){console.log("uploadComplete"),e.$apply(function(){e.progressVisible=!1,console.log(JSON.parse(o.target.responseText)),e.filepicker.alerts=[JSON.parse(o.target.responseText)],e.filepicker.loadFiles()})}function i(){console.log("uploadFailed"),e.$apply(function(){e.filepicker.alerts=[{"class":"error",label:"Failed",message:"There was an error attempting to upload the file."}]})}function a(){console.log("uploadCanceled"),e.$apply(function(){e.progressVisible=!1,e.filepicker.alerts=[{"class":"error",label:"Canceled",message:"The upload has been canceled by the user or the browser dropped the connection."}]})}function l(e){for(var o=atob(e.split(",")[1]),t=[],r=0;o.length>r;r++)t.push(o.charCodeAt(r));return new Blob([new Uint8Array(t)],{type:"image/png"})}console.log("FilepickerCtrl ("+e.$id+")"),e.filepicker=t;var c=document.getElementById("dropbox");c.addEventListener("dragenter",r,!1),c.addEventListener("dragleave",r,!1),c.addEventListener("dragover",function(o){o.stopPropagation(),o.preventDefault();var t=o.dataTransfer&&o.dataTransfer.types&&(o.dataTransfer.types.indexOf("Files")>=0||o.dataTransfer.types.indexOf("text/uri-list")>=0);e.$apply(function(){e.filepicker.setDropzoneName(t),e.dropClass=t?"alert-success":"alert-error"})},!1),c.addEventListener("drop",function(o){o.stopPropagation(),o.preventDefault(),e.$apply(function(){e.filepicker.setDropzoneName(!0),e.dropClass=""}),o.dataTransfer.getData("URL")?e.url.load(o.dataTransfer.getData("URL")):e.setFiles(o.dataTransfer.files)},!1),e.computer={},e.computer.buttonClick=function(){e.filepicker.args.multi?document.getElementById("file_multi_upload").click():document.getElementById("file_upload").click()},e.computer.buttonSelect=function(o){console.log("computer.buttonSelect(element)"),console.log(o),e.setFiles(o.files)},e.url={},e.url.value="",e.url.load=function(t){t=encodeURIComponent(t),e.filepicker.args.resizecrop?e.setFiles([{name:t,type:"image/"+t.substr(t.lastIndexOf("."))}]):o.post(e.settings.server+"/filepicker/url/"+e.filepicker.args.action+"/"+e.filepicker.args.ID,{url:t}).success(function(e){console.log("url.load.post.success"),console.log(e),e={target:{responseText:e}},s(JSON.stringify(e))}).error(function(){console.log("url.load.post.error"),i()})},e.resizecrop={img:{}},e.resizecrop.initParams=function(o,t){var r={};r.src=o,r.type=t,r.zoom=100,r.canvas,r.data="",e.resizecrop.img=r},e.resizecrop.loadFile=function(){for(var o in e.files)if(e.files[o].type.match(/image.*/)){console.log(e.files[o]);var t=e.files[o],r=new FileReader;r.onload=function(o){console.log("loadFile.reader.onload"),e.resizecrop.initParams(o.target.result,t.type),e.$apply(function(){e.resizecrop.generate(),0==e.filepicker.args.multi&&(e.filepicker.args.service="RESIZECROP")})},r.readAsDataURL(t)}},e.resizecrop.loadURL=function(t,r){var t=e.files[0].name,n=e.settings.server+"/filepicker/url/?url="+t,r=e.files[0].type;o.get(n+"&callback=JSON_CALLBACK").success(function(){console.log("loadURL.get.success"),e.resizecrop.initParams(n,r),e.resizecrop.generate(),0==e.filepicker.args.multi&&(e.filepicker.args.service="RESIZECROP")}).error(function(){e.filepicker.alerts=[{"class":"error",label:"Failed",message:"There was an error attempting to obtain the image."}]})},e.resizecrop.generate=function(){var o=new Image;o.onload=function(){function t(){f=Math.round(i*(h>v?h:v))*e.resizecrop.img.zoom/100,m=Math.round(a*(h>v?h:v))*e.resizecrop.img.zoom/100;var t=y-f/2>g,r=g+l>y+f/2,n=$-m/2>d,s=d+c>$+m/2;t?(console.log("l"),y=g+f/2):r&&(console.log("r"),y=g+l-f/2),n?(console.log("t"),$=d+m/2):s&&(console.log("b"),$=d+c-m/2);var u=document.createElement("canvas");u.width=f,u.height=m,u.getContext("2d").drawImage(o,0,0,f,m),e.resizecrop.img.canvas=u}function r(){b.width=u,b.height=p;var o=b.getContext("2d");o.drawImage(e.resizecrop.img.canvas,y-f/2,$-m/2),o.save(),o.globalAlpha=.5,o.beginPath(),o.rect(0,0,g,p),o.rect(g,0,l,d),o.rect(g+l,0,g,p),o.rect(g,d+c,l,d),o.fillStyle="white",o.fill(),o.beginPath(),o.rect(g,d,l,c),o.lineWidth=1,o.strokeStyle="grey",o.stroke(),document.getElementById("resizecrop").innerHTML="",document.getElementById("resizecrop").appendChild(b),n()}function n(){var o=Math.round((m-c)/2-($-p/2)),t=Math.round((f-l)/2-(y-u/2)),r=document.createElement("canvas");r.width=l,r.height=c,r.getContext("2d").drawImage(e.resizecrop.img.canvas,t,o,l,c,0,0,l,c),e.resizecrop.img.data=r.toDataURL(e.resizecrop.img.type)}function s(e){var o,t,n=0,s=0,i=this;e.pageX||e.pageY?(o=e.pageX,t=e.pageY):(o=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);do n+=i.offsetLeft-i.scrollLeft,s+=i.offsetTop-i.scrollTop;while(i=i.offsetParent);0===w&&0===_&&(w=o-n-y,_=t-s-$);var a=n+g>o-f/2-w,u=o+f/2-w>n+g+l,p=s+d>t-m/2-_,h=t+m/2-_>s+d+c;a&&u?y=o-n-w:a?y=g+l-f/2:u&&(y=g+f/2),p&&h?$=t-s-_:p?$=d+c-m/2:h&&($=d+m/2),r()}console.log("image.onload");var i=this.width,a=this.height,l=e.filepicker.args.width,c=e.filepicker.args.height,u=1.5*l,p=1.5*c,g=(u-l)/2,d=(p-c)/2,f=i,m=a,h=l/i,v=c/a,y=u/2,$=p/2;t();var b=document.createElement("canvas");r(),1==e.filepicker.args.multi&&e.resizecrop.save(),document.getElementById("resizecrop-zoom").onchange=function(){t(),r()};var w=0,_=0;b.onselectstart=function(){return!1},b.onmouseover=function(){},b.onmouseout=function(){},b.onmousedown=function(){w=0,_=0,b.onmousemove=s,document.onselectstart=null},b.onmouseup=function(){console.log("onmouseup"),b.onmousemove=null}},o.onerror=function(){},o.src=e.resizecrop.img.src},e.resizecrop.save=function(){console.log("resizecrop.save");var o=l(e.resizecrop.img.data);e.files[0]=o,e.uploadFiles()},e.camera={},e.camera.save=function(){console.log("camera.save"),console.log(t.camera),(e.filepicker.camera.video.videoWidth||e.filepicker.camera.video.videoHeight)&&(e.filepicker.camera.canvas.width=e.filepicker.camera.video.videoWidth,e.filepicker.camera.canvas.height=e.filepicker.camera.video.videoHeight,e.filepicker.camera.ctx.drawImage(e.filepicker.camera.video,0,0),e.files[0]={name:"camera"+ +new Date+".png",type:"image/png"},e.resizecrop.initParams(e.filepicker.camera.canvas.toDataURL("image/png"),"image/png"),e.resizecrop.generate(),0==e.filepicker.args.multi&&(e.filepicker.args.service="RESIZECROP",e.filepicker.cameraStop()))},e.files=[],e.setFiles=function(o){if(console.log("setFiles(files)"),console.log("files:",o),o.length>0){e.files=[];for(var t=!1,r=0;o.length>r;r++){console.log(o[r]);var n=o[r].name.substr(o[r].name.lastIndexOf(".")),s=-1!==e.filepicker.args.types.indexOf("*/*")||-1!==e.filepicker.args.types.indexOf(o[r].type.substr(0,o[r].type.indexOf("/"))+"/*")||-1!==e.filepicker.args.types.indexOf(o[r].type),i=0==e.filepicker.args.extensions.length||-1!==e.filepicker.args.extensions.indexOf(n);s?i?e.files.push(o[r]):e.filepicker.alerts.push({"class":"error",label:"Invalid File Extension",message:"Try: "+e.filepicker.args.extensions.join(", ")}):(t=!0,e.filepicker.alerts.push({"class":"error",label:"Invalid File Type",message:"Try: "+e.filepicker.args.types.join(", ")}))}e.files.length&&(e.filepicker.args.resizecrop?e.files[0].name.match(/^http/)?e.resizecrop.loadURL():e.resizecrop.loadFile():e.uploadFiles())}},e.uploadFiles=function(){for(var o in e.files)console.log(e.files[o]),e.uploadFile(e.files[o])},e.uploadFile=function(o){console.log("uploadFile()"),o||(o=e.files[0]),e.progressVisible=!1;var t=new FormData;t.append("file",o);var r=new XMLHttpRequest;r.upload.addEventListener("progress",n,!1),r.addEventListener("load",s,!1),r.addEventListener("error",i,!1),r.addEventListener("abort",a,!1),r.open("POST",$rootScope.settings.server+"/filepicker/computer/"+e.filepicker.args.action+"/"+e.filepicker.args.ID),e.progressVisible=!0,r.send(t)},e.ftp={},e.ftp.connect=function(t){t=encodeURIComponent(t),o.post(e.settings.server+"/filepicker/url/"+e.filepicker.args.action+"/"+e.filepicker.args.ID,{url:t}).success(function(e){console.log("url.load.post.success"),console.log(e),e={target:{responseText:e}},s(JSON.stringify(e))}).error(function(){console.log("url.load.post.error"),i()})}}]),ContactCtrl.$inject=["$scope","$http"],angular.module("io.controller.follow",[]).controller("FollowCtrl",["$scope","$http",function(e,o){console.log("FollowCtrl ("+e.$id+")"),e.type=e.follow.type,e.follow_suggest={},e.following={},e.followers={},e.loadFollowers=function(t,r,n){t||(t=0),r||(r=0),n||(n=""),o.get($rootScope.settings.server+"/follow/ers/"+t+"/"+r+"/"+n).success(function(o){console.log("loadFollowing.get.success"),console.log(o),console.log(typeof o);for(var t=0,r=o.length;r>t;t++)o[t].follower=o[t].follower?!0:!1;e.followers=o}).error(function(){console.log("loadFollowing.get.error"),$rootScope.http_error()})},e.loadFollowing=function(t,r,n){t||(t=0),r||(r=0),n||(n=""),o.get($rootScope.settings.server+"/follow/ing/"+t+"/"+r+"/"+n).success(function(o){console.log("loadFollowing.get.success"),console.log(o),console.log(typeof o);for(var t=0,r=o.length;r>t;t++)o[t].following=o[t].following?!0:!1;e.following=o}).error(function(){console.log("loadFollowing.get.error"),$rootScope.http_error()})},e.loadSuggestions=function(){console.log("loadSuggestions()"),o.get($rootScope.settings.server+"/follow/suggestions/"+!0).success(function(o){console.log("loadSuggestions.get.success"),console.log(o);for(var t=0,r=o.length;r>t;t++)o[t].following=o[t].following?!0:!1,o[t].company_ID?e.follow.db.company[o[t].company_ID]=o[t]:o[t].user_ID&&(e.follow.db.user[o[t].user_ID]=o[t]);objectLength(o)&&(e.follow_suggest=o),console.log($rootScope.objectLength(e.follow_suggest))}).error(function(){console.log("loadSuggestions.get.error"),$rootScope.http_error()})},e.loadGroups=function(){e.follow.loadGroups()},e.require_signin(function(){e.loadGroups()})}]),MessageCtrl.$inject=["$scope","$http","$routeParams"],angular.module("io.init.rootScope",[]).run(["$rootScope","$locale","$cookies","$http","$window","$location",function(e,o,t,r,n,s){console.log("io.init.rootScope ("+e.$id+")"),e.default_settings={client:"",server:"",proxy:"",dashboard:"app",i18n:{"default":"en-ca",lang:["languages"],"lang-locale":["app","angular-io"],options:[]},json:{},password:{min_timestamp:0,max_age:90,min_length:10,min_params:3,min_upper:1,min_lower:1,min_number:1,min_special:1},account:{user_name:!1,company:!1,company_user:!1},notify:{},security:{},onboard:{required:!1,start:""},filepicker:{user_single_image:{action:"user_single_image",types:["image/*"],extensions:[".jpg",".jpeg",".gif",".bmp",".png"],services:["COMPUTER"],service:"COMPUTER",multi:!1,resizecrop:!0,width:200,height:200},company_single_image:{action:"company_single_image",types:["image/*"],extensions:[".jpg",".jpeg",".gif",".bmp",".png"],services:["COMPUTER"],service:"COMPUTER",multi:!1,resizecrop:!0,width:300,height:200}}},e.settings=syncVar(e.settings,e.default_settings),delete e.default_settings,console.log("$rootScope.settings:"),console.log(e.settings),e.session=db.get("session",{}),e.resetSession=function(){console.log("resetSession()"),console.log(e.$id),e.session={},db.set("session",e.session)
},e.saveSession=function(){console.log("saveSession()"),e.session.save&&db.set("session",e.session)},e.updateSession=function(o){console.log("updateSession(callback)"),console.log(o),r.get(e.settings.server+"/account/session").success(function(t){console.log("updateSession.get.success"),console.log(t),t==[]?e.href("#/sign/out"):(e.session=syncVar(t,e.session),e.saveSession(),o&&e.$eval(o()))}).error(function(){console.log("updateSession.get.error"),e.http_error()})},e.regenSession=function(){console.log("regenSession()"),r.get(e.settings.server+"/account/regen").success(function(){console.log("regenSession.get.success")}).error(function(){console.log("regenSession.get.error"),e.http_error()})},e.checkSession=function(o){console.log("checkSession(callback)"),console.log(o),r.get(e.settings.server+"/account/signcheck").success(function(t){console.log("checkSession.get.success"),console.log(t),parseInt(t,10)?objectIsEmpty(e.session)?e.updateSession(o):o&&e.$eval(o()):e.session.user_ID&&e.href("#/sign/out")}).error(function(){console.log("checkSession.get.error"),e.http_error()})},e.require_signin=function(o){console.log("require_signin(callback)"),console.log(o),objectIsEmpty(e.session)?"#/sign/in"!=e.uri()&&(t.redirect=e.uri().substr(2),e.href("#/sign/in")):e.settings.onboard.required&&!e.session.email_confirm&&null===e.uri().match(/#\/onboard\/email/)?(console.log("email not confirmed = "+e.settings.onboard.required+" && "+!e.session.email_confirm+" && "+(null===e.uri().match(/#\/onboard/))),e.href("#/onboard/email")):e.settings.onboard.required&&!e.session.timestamp_create&&null===e.uri().match(/#\/onboard/)?(console.log("onboard not completed = "+e.settings.onboard.required+" && "+!e.session.timestamp_create+" && "+(null===e.uri().match(/#\/onboard/))),e.href("#/onboard/"+e.settings.onboard.start)):e.settings.password.max_age&&e.session.password_age>e.settings.password.max_age?(console.log(e.settings.password.max_age+" && "+(e.session.password_age>e.settings.password.max_age)),e.href("#/onboard/password")):e.settings.password.min_timestamp&&e.session.password_timestamp<e.settings.password.min_timestamp?e.href("#/onboard/password"):o&&e.$eval(o())},e.loader={width:0,details:"",count:0,total:objectLength(e.settings["class"])+e.settings.i18n.lang.length+e.settings.i18n["lang-locale"].length+e.settings.i18n.json.length+objectLength(e.settings.json)},e.$on("loaderEvent",function(o,t){t=t?t.replace(/[^0-9a-zA-Z]/g," "):"",++e.loader.count,console.log(e.loader.count+" / "+e.loader.total+" "+t),e.loader.count<e.loader.total&&(e.loader.width=100*(e.loader.count/e.loader.total),e.loader.details=t)}),e.$on("$viewContentLoaded",function(){}),e.$on("$includeContentLoaded",function(){}),e.set=function(o,t){e[o]=t},e.device="undefined"!=typeof device?device:!1,e.loading=!1,e.sliderNav=-1,e.alerts=[],e.modal={},e.datetime=new Date,e.timezone_min=(new Date).getTimezoneOffset(),e.i18n={},e.json={regions:{}},e.$watch(function(){return s.path()},function(){e.alerts=[]}),e.loadJSON=function(o,t,n){n||(n="json"),console.log("loadJSON("+o+", "+t+")"),r.get(e.settings.client+"/"+n+"/"+t+".json").success(function(r){console.log("loadJSON.get("+o+"/"+t+").success"),e.$emit("loaderEvent",o),e.json[o]=r}).error(function(){console.log("loadJSON.get("+o+"/"+t+").error"),e.$emit("loaderEvent",o),e.json[o]={}})};for(var a in e.settings.json)e.loadJSON(a,e.settings.json[a]);e.init=function(){e.locale=db.get("locale",o.id),e.language=db.get("language",e.locale.substr(0,2)),db.set("language",e.language),e.locale.length>2?(e.country_code=e.locale.substr(3,2).toUpperCase(),db.set("country_code",e.country_code)):e.country_code=db.get("country_code",o.id.substr(3,2).toUpperCase())},e.changeLocale=function(e){db.set("locale",e),db.set("language",e.substr(0,2)),e.length>2&&db.set("country_code",e.substr(3,2).toUpperCase()),window.location.reload()},e.loadLocaleFile=function(o,t){console.log("loadLocaleFile("+o+", "+t+")"),r.get(e.settings.client+"/i18n/"+o+"/"+t+".json").success(function(r){console.log("loadLocaleFile.get("+o+"/"+t+").success");for(var n in r)e.i18n[n]=r[n];e.i18n.id=o,e.$emit("loaderEvent",o)}).error(function(){console.log("loadLocaleFile.get("+o+"/"+t+").error"),2==o.length?e.loadLocaleFile(e.settings.i18n["default"],t):e.loadLocaleFile(o.substr(0,2),t)})},e.loadLocale=function(){console.log("loadLocale()");for(var o=0,t=e.settings.i18n.lang.length;t>o;o++)console.log(e.language+"/"+e.settings.i18n.lang[o]),e.loadLocaleFile(e.language,e.settings.i18n.lang[o]);for(var o=0,t=e.settings.i18n["lang-locale"].length;t>o;o++)console.log(e.locale+"/"+e.settings.i18n["lang-locale"][o]),e.loadLocaleFile(e.locale,e.settings.i18n["lang-locale"][o]);for(var o=0,t=e.settings.i18n.json.length;t>o;o++)console.log(e.language+"/"+e.settings.i18n.json[o]),e.loadJSON(e.settings.i18n.json[o],e.language+"/"+e.settings.i18n.json[o],"i18n")},e.loadRegions=function(o){e.json.regions||(e.json.regions={}),e.json.regions[o]||(console.log("loadRegions("+o+")"),r.get(e.settings.client+"/i18n/"+e.language+"/geo/"+o+".json").success(function(t){console.log("loadRegions.get.success"),e.json.regions[o]=t}).error(function(){console.log("loadRegions.get.error")}))},e.init(),e.loadLocale(e.locale),e.json.month=o.DATETIME_FORMATS.SHORTMONTH,e.json.day=function(e,o){var t={};if(e&&o)for(var r=1,n=32-new Date(e,o,32).getDate();n>=r;r++)a=numberPadding(""+r,2),t[a]=a;return t},e.offline=db.get("offline",{_state:!n.navigator.onLine,_requests:[],_count:0}),e.offline.que_request=function(o,t){console.log("offline.que_request(http_config, callback)"),t||(t=function(){}),e.offline._requests.push({http_config:o,callback:t}),e.offline.store()},e.offline.run_request=function(){if(console.log("offline.run_request()"),e.offline._requests.length){e.loading=!0;var o=e.offline._requests.shift();console.log("offline.run_request.http("+o.http_config.method+" "+o.http_config.url+" "+JSON.stringify(o.http_config.data)+")"),r(o.http_config).success(function(t,r,n,s){console.log("offline.run_request.http.success"),o.callback&&o.callback(t,r,n,s),e.loading=!1,e.offline.store(),e.offline.run_request()}).error(function(t,r,n,s){console.log("offline.run_request.http.error"),console.log(""+JSON.stringify(t)+", "+r+", "+n+", "+JSON.stringify(s)),e.offline._requests.unshift(o),e.loading=!1})}},e.offline.store=function(){db.set("offline",{_state:e.offline._state,_requests:e.offline._requests,_count:e.offline._requests.length})},e.offline.alertOffline=function(){console.log("offline.alertOffline()"),e.modal={hide:{header:!1,close:!1,footer:!1},header:e.i18n.alert_online_offline_label,content:e.i18n.alert_online_offline_message,buttons:[{"class":"btn-primary",value:"Ok",callback:function(){}}]},$("#alertModal").modal("show")},e.offline.alertOnline=function(){console.log("offline.alertOnline()"),e.modal={hide:{header:!1,close:!1,footer:!1},header:e.i18n.alert_offline_online_label,content:e.i18n.alert_offline_online_message,buttons:[{"class":"btn-primary",value:"Ok, Thanks!",callback:function(){}}]},$("#alertModal").modal("show")},e.http_error=function(){e.alerts=[{"class":"error",label:"Connection Error:",message:"We were unable to complete you request at this time."}]},n.addEventListener("online",function(){console.log("Event online"),e.offline._state&&(e.offline.alertOnline(),setTimeout(function(){e.offline.run_request()},1e3),e.checkSession()),e.offline._state=!1,e.$digest()},!0),n.addEventListener("offline",function(){console.log("Event offline"),e.offline._state=!0,e.offline.alertOffline(),e.$digest()},!0),e.uri=function(){var e=-1==s.$$url.indexOf("?")?s.$$url:s.$$url.substr(0,s.$$url.indexOf("?"));return"#"+e},e.href=function(e,o){e||(e="#"),console.log("href -> "+e),o?window.open(e,"_blank","location=yes"):window.location.href=e},e.refresh=function(){e.href(e.uri()+"?"+ +new Date)},e.history=history,e.loadStyle=function(e){var o=document.getElementsByTagName("head")[0],t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,t.media="screen",o.appendChild(t)},e.unloadStyle=function(e){for(var o=document.getElementsByTagName("link"),t=o.length;t>=0;t--)o[t]&&null!=o[t].getAttribute("href")&&-1!=o[t].getAttribute("href").indexOf(e)&&o[t].parentNode.removeChild(o[t])},e.loadScript=function(e,o){var t=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=e,r.onreadystatechange=o,r.onload=o,t.appendChild(r)},e.unloadScript=function(e){for(var o=document.getElementsByTagName("script"),t=o.length;t>=0;t--)o[t]&&null!=o[t].getAttribute("src")&&-1!=o[t].getAttribute("src").indexOf(e)&&o[t].parentNode.removeChild(o[t])},e.validate={},e.validate.password=function(e,o,t,r){if(console.log('validate.password(scope, "'+o+'", "'+t+'", settings)'),console.log(r),o||(o=""),t||(t=""),e.$error={},!o.length)return e.$valid=objectIsEmpty(e.$error),e.$invalid=!e.$valid,void 0;o.length<r.min_length&&(e.$error.minlength=!0);var n={lower:[0,0],upper:[0,0],number:[0,0],special:[0,0]};for(i=0;o.length>i;i++)"abcdefghijklmnopqrstuvwxyz".indexOf(o.charAt(i))>-1?(n.lower[0]=1,++n.lower[1]):"ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(o.charAt(i))>-1?(n.upper[0]=1,++n.upper[1]):"0123456789".indexOf(o.charAt(i))>-1?(n.number[0]=1,++n.number[1]):"~!@#$%^&*()_+{}|:\"<>? `-=[];',./".indexOf(o.charAt(i))>-1&&(n.special[0]=1,++n.special[1]),i>1&&o.charAt(i)==o.charAt(i-1)&&o.charAt(i)==o.charAt(i-2)&&(e.$error.identical=!0);n.lower[0]+n.upper[0]+n.number[0]+n.special[0]<r.min_params&&(e.$error.upper=n.upper[1]<r.min_upper,e.$error.lower=n.lower[1]<r.min_lower,e.$error.number=n.number[1]<r.min_number,e.$error.special=n.special[1]<r.min_special),o===t&&(e.$error.sameas=!0),e.$valid=objectIsEmpty(e.$error),e.$invalid=!e.$valid},e.inArray=function(e,o){if(!o)return!1;for(var t=0,r=o.length;r>t;t++)if(o[t]==e)return!0;return!1},e.objectIsEmpty=function(e){for(var o in e)return!1;return!0},e.objectLength=function(e){var o=0;for(var t in e)e.hasOwnProperty(t)&&++o;return o},e.objectArray=function(e){var o=[];for(var t in e)o.push(e[t]);return o}}]),angular.module("io.init.settings",[]).run(["$rootScope",function(e){console.log("io.init.settings ("+e.$id+")"),e.settings={client:"",server:"",dashboard:"app",i18n:{"default":"en",lang:[],"lang-locale":["angular-io","app"],json:["countries","languages","user_levels"],options:["en"]},json:{calling_codes:"calling_codes"},account:{user_name:!1,company:!1,company_username:!1},notify:{new_message:{email:!1},new_follow:{email:!1}},onboard:{required:!0,start:"user"},filepicker:{user_single_image:{action:"user_single_image",types:["image/*"],extensions:[".jpg",".jpeg",".gif",".bmp",".png"],services:["COMPUTER","URL"],service:"COMPUTER",multi:!1,resizecrop:!0,width:200,height:200},company_single_image:{action:"company_single_image",types:["image/*"],extensions:[".jpg",".jpeg",".gif",".bmp",".png"],services:["COMPUTER","URL"],service:"COMPUTER",multi:!1,resizecrop:!0,width:300,height:200}},follow:"user"}}]),angular.module("app.route",[]).config(["$routeProvider",function(e){var o="view/",t="app/";e.when("/sign/:action",{templateUrl:o+"account/sign.html"}).when("/confirm/:confirm_hash",{templateUrl:o+"account/sign.html"}).when("/reset/:reset_hash",{templateUrl:o+"account/reset.html"}).when("/user/message",{templateUrl:o+"user/message.html"}).when("/user/message/:user_ID",{templateUrl:o+"user/message.html"}).when("/user/invite",{templateUrl:o+"user/invite.html"}).when("/profile/:profile_name",{templateUrl:o+"user/profile.company.html"}).when("/user/profile",{templateUrl:o+"user/profile.user.html"}).when("/user/profile/:profile_ID",{templateUrl:o+"user/profile.user.html"}).when("/company/profile",{templateUrl:o+"user/profile.company.html"}).when("/company/profile/:profile_ID",{templateUrl:o+"user/profile.company.html"}).when("/onboard/password",{templateUrl:o+"onboard/password.html"}).when("/onboard/:page",{templateUrl:o+"onboard.html"}).when("/onboard/:page/:action",{templateUrl:o+"onboard.html"}).when("/settings/:page",{templateUrl:o+"settings.html"}).when("/support/:page",{templateUrl:o+"support.html"}).when("/app",{templateUrl:o+t+"index.html"}).when("/",{templateUrl:o+t+"index.html"}).when("/:page",{templateUrl:o+"page.html"}).otherwise({redirectTo:"/"})}]),angular.module("io.config",[]).value("io.config",{}),angular.module("io.controllers",["io.controller.company","io.controller.confirm","io.controller.onboard","io.controller.page","io.controller.reset","io.controller.sign","io.controller.user","io.controller.password"]),angular.module("io.directives",["io.config","io.directive.htmlExtend","io.directive.inputMask"]),angular.module("io.filters",["io.config","io.filter.format","io.filter.range"]),angular.module("io.factories",["io.config"]),angular.module("io.init",["io.config","io.init.settings","io.init.rootScope"]),angular.module("io.markdown",["io.config","io.directive.markdown"]),angular.module("io.follow",["io.config","io.factory.follow","io.controller.follow"]),angular.module("io.message",["io.config","io.filter.truncate","io.factory.message"]),angular.module("io.filepicker",["io.config","io.factory.filepicker","io.controller.filepicker"]),angular.module("io.accessibility",["io.config","io.factory.accessibility"]),angular.module("io.plugins",["io.follow","io.message","io.filepicker","io.accessibility","io.markdown"]),angular.module("io",["io.directives","io.filters","io.factories","io.plugins","io.init","io.config"]),angular.module("app.config",[]).value("app.config",{}),angular.module("app.controllers",["io.controller.contact","app.controller.root","app.controller.dashboard"]),angular.module("app.directives",["app.config","ui.directives.if","ng.components"]),angular.module("app.filters",["app.config"]),angular.module("app.factories",["app.config"]),angular.module("app.init",["app.config","app.route"]);var app=angular.module("app",["ngCookies","io","app.directives","app.filters","app.factories","app.init","app.config"]);AppCtrl.$inject=["$rootScope","$scope","$http","$filepicker","$accessibility","$message","$follow"],DashboardCtrl.$inject=["$scope","$http","$routeParams"];